Bootstrap: localimage
From: /work/git_projects/PSR_Singularity/psrpta.sif

%help
    Pleb + PQC container built on psrpta.sif.
    Usage: singularity exec pleb.sif pleb --help

%files
    /work/git_projects/pleb/ /opt/pleb
    /work/git_projects/pqc/ /opt/pqc

%post
    set -e
    export PIP_DISABLE_PIP_VERSION_CHECK=1
    export PIP_IGNORE_REQUIRES_PYTHON=1

    mkdir -p /opt/pleb_data/configs/settings
    mkdir -p /opt/pleb_data/configs/workflows
    mkdir -p /opt/pleb_data/results
    mkdir -p /opt/pleb_data/logs

    cp -a /opt/pleb/configs/settings/. /opt/pleb_data/configs/settings/
    cp -a /opt/pleb/configs/workflows/. /opt/pleb_data/configs/workflows/

    python3 -m pip install -e /opt/pqc
    python3 -m pip install -e /opt/pleb[plot,gui,qc]

%environment
    export PLEB_DATA=/opt/pleb_data
    export PLEB_CONFIGS=/opt/pleb_data/configs

%runscript
    exec pleb "$@"
